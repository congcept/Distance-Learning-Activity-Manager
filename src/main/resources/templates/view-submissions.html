<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>View Submissions</title>
    <div th:replace="~{fragments :: head-meta}"></div>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>
    <div class="container">
        <div th:replace="~{fragments :: header(backLink=@{/activities(courseId=${courseId})})}"></div>
        <h2 th:text="'Submissions for Activity ID: ' + ${activityId}">Submissions</h2>

        <p th:if="${#lists.isEmpty(submissions)}">No submissions yet.</p>

        <div th:each="s : ${submissions}" class="activity-card">
            <p><strong>Student: </strong><span th:text="${s.student.fullName} + ' (ID: ' + ${s.studentId} + ')'">Student
                    Name</span></p>
            <p><strong th:text="'Submitted on: ' + ${s.submissionDate}">Date</strong></p>
            <p><strong>Content:</strong><br> <span th:text="${s.content}">Content</span></p>
            <p th:if="${s.filePath}">
                <strong>Attachment:</strong> <a th:href="@{${s.filePath}}" th:text="${s.originalFilename}"
                    target="_blank">Download</a>
            </p>

            <hr>

            <form th:action="@{/grade-submission}" method="post">
                <input type="hidden" name="submissionId" th:value="${s.id}">
                <input type="hidden" name="activityId" th:value="${activityId}">
                <input type="hidden" name="courseId" th:value="${courseId}">
                <input type="hidden" name="returnTo" th:value="${param.returnTo}">

                <label>Grade:</label>
                <input type="text" name="grade" th:value="${s.grade}" placeholder="e.g. A, 90/100" required>

                <label>Feedback:</label>
                <textarea name="feedback" rows="3" th:text="${s.feedback}"></textarea>

                <button type="submit">Update Grade</button>
            </form>
        </div>
    </div>

    <div class="comments-section">
        <h3>Discussion / Q&A</h3>
        <div class="comment-list">
            <p th:if="${#lists.isEmpty(comments)}">No comments yet.</p>
            <div th:each="comment : ${comments}" class="comment-card">
                <div class="comment-header">
                    <span class="comment-author" th:text="${comment.authorName}">Author</span>
                    <span class="comment-time"
                        th:text="${#temporals.format(comment.postedAt, 'dd-MM-yyyy HH:mm')}">Date</span>
                </div>
                <div class="comment-content" th:text="${comment.content}">Content</div>
            </div>
        </div>

        <form th:action="@{/add-comment}" method="post">
            <input type="hidden" name="activityId" th:value="${activityId}">
            <input type="hidden" name="courseId" th:value="${courseId}">
            <input type="hidden" name="redirectUrl"
                th:value="'/view-submissions?activityId=' + ${activityId} + '&courseId=' + ${courseId}">

            <textarea name="content" rows="3" placeholder="Reply to students..." required></textarea>
            <button type="submit" class="btn btn-primary btn-sm" style="margin-top: 5px;">Post Comment</button>
        </form>
    </div>
    </div>
</body>

</html>